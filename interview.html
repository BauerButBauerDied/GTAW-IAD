<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/x-icon" href="css/img/k9.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <link rel="stylesheet" href="css/metrodeploy.css">
    <title>Bite Report</title>
</head>
<body>    
    <button id="clearLocalStorageButton">Clear Format</button>
    <div class="ui container">
        <div class="ui form">
            <div class="ui segment">
                <h2>Submission Information</h2>
                <div class="field">
                    <label for="datetimePickerSubmission">Date and Time (If Retroactive)</label>
                    <div class="four fields">
                        <div class="field">
                            <input type="datetime-local" id="datetimePickerSubmission">
                        </div>
                        <div class="field">
                            <button id="nowButtonSubmission">Set to Now</button>
                        </div>
                    </div>
                </div>   
                <div class="field">
                    <label>Submitted By</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" placeholder="Sergeant Firstname Lastname" id="Submitter">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label for="SubmissionType">Type of Submission</label>
                    <div class="three fields">
                        <div class="field">
                            <div class="ui selection search dropdown" id="SubmissionTypeDropdown">
                                <input type="hidden" name="SubmissionType" id="SubmissionTypeInput">
                                <i class="dropdown icon"></i>
                                <div class="default text">Select Submission Type</div>
                                <div class="menu">
                                    <div class="item" data-value="Administrative Interview">Administrative Interview</div>
                                    <div class="item" data-value="Criminal Interrogation">Criminal Interrogation</div>
                                    <div class="item" data-value="Criminal Interrogation">Field Statement</div>
                                    <div class="item" data-value="Voluntary Witness Interview">Voluntary Witness Interview</div>
                                    <div class="item" data-value="Mandatory Witness Interview">Mandatory Witness Interview</div>
                                    <div class="item" data-value="on-Department Employee Interview">Non-Department Employee Interview</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="ui container">
        <div class="ui form">
            <div class="ui segment">
                <h2>Overview</h2>
                <div class="field">
                    <label for="datePickerOverview">Date</label>
                    <div class="four fields">
                        <div class="field">
                            <input type="date" id="datePickerOverview">
                        </div>
                        <div class="field">
                            <button id="todayButtonOverview">Set to Today</button>
                        </div>
                    </div>
                </div>    
                <div class="field">
                    <label>Start Time</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" id="startTime" placeholder="HH:MM">
                        </div>
                        <div class="field">
                            <button id="oneHourAgo">One Hour Ago</button>
                            <button id="twoHoursAgo">Two Hours Ago</button>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>End Time</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" id="endTime" placeholder="HH:MM">
                        </div>
                        <div class="field">
                            <button id="nowButton">Now</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="ui container">
        <div class="ui form">
            <div class="ui segment">
                <h2>Parties Involved</h2>
                <div class="field">
                    <label>Parties Involved</label>
                    <div id="PartiesInvolvedContainer">
                        <div class="field">
                            <div class="ui selection search dropdown" id="RoleDropdown">
                                <input type="hidden" name="Role" id="RoleInput">
                                <i class="dropdown icon"></i>
                                <div class="default text">Select Role</div>
                                <div class="menu">
                                    <div class="item" data-value="Investigator">Investigator</div>
                                    <div class="item" data-value="Witness">Witness</div>
                                    <div class="item" data-value="Reported Employee">Reported Employee</div>
                                    <div class="item" data-value="Representative">Representative</div>
                                </div>
                            </div>
                            <input type="text" placeholder="Firstname Lastname" id="InvolvedParty">
                        </div>
                    </div>
                    <button type="button" id="addInput">+</button>
                    <button type="button" id="removeInput">-</button>
                </div>
            </div>
        </div>
    </div>
    <div class="ui container">
        <div class="ui form">
            <div class="ui segment">
                <h2>Summary & Transcript</h2>
                <div class="field">
                    <label for="Summary">Summary</label>
                    <textarea id="Summary"></textarea>
                </div>              
                <label for="Transcript">Transcript</label>
                <textarea id="Transcript"></textarea>
            </div>
        </div>
    </div>
    <div class="ui container">
        <div class="ui form">
            <div class="ui segment">
                <h2>Generator</h2>
                <div class="field">
                    <label>Output</label>
                    <textarea id="output" readonly></textarea>
                </div>
                <div class="ui secondary button" id="submit">Submit</div>
                <div class="ui primary button" id="copy">Copy to Clipboard</div>
                <a href="https://lspd.gta.world/viewforum.php?f=2146">
                    <div class="ui third button" id="fieldrecords">Field Records Link</div>
                  </a>                  
            </div>
    </div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
    <script src="js/bitereport.js"></script>
    <script>
        $(document).ready(function () {
            $('.ui.search.dropdown').dropdown({
                fullTextSearch: true
            });
        });

        $(document).ready(function () {
            $("#addInput").click(addInputField("#PartiesInvolvedContainer"));
            $("#removeInput").click(removeInputField("#PartiesInvolvedContainer"));
        });

        function addInputField(containerId) {
            return function () {
                const inputFieldsContainer = $(containerId);
                const newInputField = $("<div>").addClass("field").html('<input type="text" placeholder="' + placeholderText + '" id="newInputField">');
                inputFieldsContainer.append(newInputField);
            };
        }

        function removeInputField(containerId) {
            return function () {
                const inputFieldsContainer = $(containerId);
                const inputFields = inputFieldsContainer.children();
                if (inputFields.length > 1) {
                    inputFields.last().remove();
                } else {
                    alert("Cannot remove the last input field.");
                }
            }
        }

    document.addEventListener('DOMContentLoaded', function () {
        const datetimePicker = document.getElementById('datetimePicker');
        const todayButton = document.getElementById('todayButton');

        todayButton.addEventListener('click', function () {
            const currentDate = new Date();
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const day = String(currentDate.getDate()).padStart(2, '0');
            const hours = String(currentDate.getHours()).padStart(2, '0');
            const minutes = String(currentDate.getMinutes()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}T${hours}:${minutes}`;
            datetimePicker.value = formattedDate;
        });

        datetimePicker.addEventListener('change', function () {
            const inputDate = new Date(datetimePicker.value);
            const year = inputDate.getFullYear();
            const month = String(inputDate.getMonth() + 1).padStart(2, '0');
            const day = String(inputDate.getDate()).padStart(2, '0');
            const hours = String(inputDate.getHours()).padStart(2, '0');
            const minutes = String(inputDate.getMinutes()).padStart(2, '0');
            const formattedDate = `${year}-${month}-${day}T${hours}:${minutes}`;
            datetimePicker.value = formattedDate;
        });
    });

    function saveDataToLocalStorage() {
        const data = {
        ICname: $('#ICname').val(),
        DivisionalRankInput: $('#DivisionalRankInput').val(),
        SerialNumber: $('#SerialNumber').val(),
        datetimePicker: $('#datetimePicker').val(),
        BittenName: $('#BittenName').val(),
        InjuryExtent: $('#InjuryExtent').val(),
        FDAttendanceInput: $('#FDAttendanceInput').val(),
        OtherOfficersName: $('#OtherOfficersName').val(),
        Narrative: $('#Narrative').val(),
        Signature: $('#Signature').val()
    };

    localStorage.setItem('metroDeploymentData', JSON.stringify(data));
}

function loadDataFromLocalStorage() {
    const data = localStorage.getItem('metroDeploymentData');
    if (data) {
        const parsedData = JSON.parse(data);

        $('#ICname').val(parsedData.ICname);
        $('#DivisionalRankInput').val(parsedData.DivisionalRankInput);
        $('#SerialNumber').val(parsedData.SerialNumber);
        $('#datetimePicker').val(parsedData.datetimePicker);
        $('#BittenName').val(parsedData.BittenName);
        $('#InjuryExtent').val(parsedData.InjuryExtent);
        $('#FDAttendanceInput').val(parsedData.FDAttendanceInput);
        $('#OtherOfficersName').val(parsedData.OtherOfficersName);
        $('#Narrative').val(parsedData.Narrative);
        $('#Signature').val(parsedData.Signature);
    }
}


        const inputFields = document.querySelectorAll('input, textarea, select');
        inputFields.forEach(function (inputField) {
            inputField.addEventListener('change', saveDataToLocalStorage);
        });

        loadDataFromLocalStorage();

        function clearLocalStorage() {
            const confirmation = confirm(
                "Are you sure you want to clear all local data?\n\n" +
                "This action will delete all stored data in your browser's local storage, including any unsaved work or settings. " +
                "If you're not sure, it's recommended to cancel this action."
            );

            if (confirmation) {
                const dataToBackup = localStorage.getItem('metroDeploymentData');
                localStorage.removeItem('metroDeploymentData');
                alert("Local storage has been cleared.");
            }
        }

        const clearButton = document.getElementById('clearLocalStorageButton');
        if (clearButton) {
            clearButton.addEventListener('click', clearLocalStorage);
        }
    </script>
</body>
</html>
