<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Meta tags and CSS links -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css">
    <link rel="stylesheet" href="css/metrodeploy.css">
    <title>Metro Deployment Report</title>
</head>
<body>    
    <!-- Add this button at the bottom of your form -->
    <button id="clearLocalStorageButton">Clear Format</button>
    <button id="undoLocalStorageButton">Undo Clear</button>

    <div class="ui container">
        <div class="ui form">
            <div class="ui segment">
                <h2>Basic Information</h2>
                <h4 class="ui dividing header">GENERAL INFORMATION</h4>

                <!-- INVOLVED PLATOONS -->
                <div class="field">
                    <label>INVOLVED PLATOONS</label>
                    <form>
                        <label><input type="checkbox" id="DPLT" name="D Platoon" value="D Platoon"> D Platoon</label><br>
                        <label><input type="checkbox" id="K9PLT" name="K9 Platoon" value="K9 Platoon"> K9 Platoon</label><br>
                        <label><input type="checkbox" id="HPLT" name="H Platoon" value="H Platoon"> H Platoon</label>
                    </form>
                </div>

                <!-- Incident Command -->
                <h4 class="ui dividing header">INCIDENT COMMAND</h4>
                <div class="field">
                    <label>INCIDENT COMMANDER (if applicable)</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" placeholder="LSPD Rank Firstname Lastname" id="ICname">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>CRISIS NEGOTIATOR (if applicable)</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" placeholder="LSPD Rank Firstname Lastname" id="CNname">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>TACTICAL COMMANDER</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" placeholder="Platoon Rank Firstname Lastname (i.e. K9 Team Leader John Doe)" id="TCname">
                        </div>
                    </div>
                </div>

                <!-- INVOLVED METROPOLITAN MEMBERS -->
                <div class="field">
                    <label>INVOLVED METROPOLITAN MEMBERS</label>
                    <div id="InvolvedMembers">
                        <div class="field">
                            <input type="text" placeholder="Platoon + Full Name" id="MMMname">
                        </div>
                    </div>
                    <button type="button" id="addInput">+</button>
                </div>
                <!-- DEPLOYMENT TYPE -->
                <div class="field">
                    <label>DEPLOYMENT TYPE</label>
                    <div class="three fields" id="DeploymentType">
                        <div class="field">
                            <div class="ui selection search dropdown">
                                <input type="hidden" name="deploymentType">
                                <i class="dropdown icon"></i>
                                <div class="default text">Select Deployment Type</div>
                                <div class="menu">
                                    <div class="item" data-value="deploymentType1">Search Warrant Execution</div>
                                    <div class="item" data-value="deploymentType2">Arrest Warrant Execution</div>
                                    <div class="item" data-value="deploymentType3">Property Search</div>
                                    <div class="item" data-value="deploymentType4">Vehicle Search</div>
                                    <div class="item" data-value="deploymentType5">Area Search</div>
                                    <div class="item" data-value="deploymentType6">Property Alarm</div>
                                    <div class="item" data-value="deploymentType7">Civil Disturbance Deployment</div>
                                    <div class="item" data-value="deploymentType8">Riot Control Deployment</div>
                                    <div class="item" data-value="deploymentType9">Protest Demonstration</div>
                                    <div class="item" data-value="deploymentType10">Event Deployment</div>
                                    <div class="item" data-value="deploymentType11">Active Drive-by Deployment</div>
                                    <div class="item" data-value="deploymentType12">Active Shooter Deployment</div>
                                    <div class="item" data-value="deploymentType13">Barricaded Suspect</div>
                                    <div class="item" data-value="deploymentType14">Protection Detail</div>
                                    <div class="item" data-value="deploymentType15">Manhunt</div>
                                    <div class="item" data-value="deploymentType16">Panic Alarm</div>
                                    <div class="item" data-value="deploymentType17">Officer Needs Help Response</div>
                                    <div class="item" data-value="deploymentType18">TAC-ALERT</div>
                                    <div class="item" data-value="deploymentType19">Scene Security</div>
                                    <div class="item" data-value="deploymentType20">Mobile Kidnapping</div>
                                    <div class="item" data-value="deploymentType21">Hostage Situation</div>
                                    <div class="item" data-value="deploymentType22">Covert Operation</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <h4 class="ui dividing header">DEPLOYMENT TIMELINE</h4>
                <div class="field">
                    <label>DATE AND TIME</label>
                    <div class="four fields">
                        <div class="field">
                            <input type="datetime-local" id="datetimePicker">
                        </div>
                        <div class="field">
                            <button id="todayButton">Set to Today</button>
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>LOCATION</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" placeholder="Streetname, nr, area" id="loc">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>START OF DEPLOYMENT</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="time" id="startTime" placeholder="HH:MM">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>END OF DEPLOYMENT</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="time" id="endTime" placeholder="HH:MM">
                        </div>
                    </div>
                </div>
                <div class="field">
                    <label>DEPLOYMENT EVENTS</label>
                    <div id="DeploymentEventsContainer">
                        <div class="field">
                            <input type="text" placeholder="Event nr. 1" id="event1">
                        </div>
                    </div>
                    <button type="button" id="addInput2">+</button>
                </div>
                <h4 class="ui dividing header">CASUALTY & INJURY INFORMATION</h4>
                <div class="field">
                    <label>INJURED TEAM MEMBERS</label>
                    <div id="InjuredMembers">
                        <div class="field">
                            <input type="text" placeholder="Injured member. 1" id="member1">
                        </div>
                    </div>
                    <button type="button" id="addInput3">+</button>
                </div>
                <div class="field">
                    <label>SUSPECT CASUALTIES</label>
                    <div id="InjuredSuspects">
                        <div class="field">
                            <input type="text" placeholder="Injured suspect. 1" id="suspect1">
                        </div>
                    </div>
                    <button type="button" id="addInput4">+</button>
                </div>
                <div class="field">
                    <label>CIVILIAN CASUALTIES</label>
                    <div id="InjuredCivilians">
                        <div class="field">
                            <input type="text" placeholder="Injured civilian. 1" id="civilain1">
                        </div>
                    </div>
                    <button type="button" id="addInput5">+</button>
                </div>
                <div class="field">
                    <label>FILING OFFICER SIGNATURE</label>
                    <div class="three fields">
                        <div class="field">
                            <input type="text" placeholder="Name" id="signature">
                        </div>
                    </div>
                </div>
                <div class="ui segment">
                    <h2>Generator</h2>
                    <div class="field">
                        <label>Output</label>
                        <textarea id="output" readonly></textarea>
                    </div>
                    <div class="ui secondary button" id="submit">Submit</div>
                    <div class="ui primary button" id="copy">Copy to Clipboard</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Your additional segments here -->

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.8/clipboard.min.js"></script>
    <script src="js/metrodeploy.js"></script>
    <script>
        // Initialize Clipboard.js
        new ClipboardJS('#copy', {
            text: function () {
                return $('#output').val();
            }
        });

        // Initialize Semantic UI Dropdown
        $(document).ready(function () {
            $('.ui.search.dropdown').dropdown({
                fullTextSearch: true // Enable full-text search
            });
        });

        // Add event listeners for adding input fields
        $(document).ready(function () {
            $("#addInput").click(addInputField("#InvolvedMembers", "Platoon + Full Name"));
            $("#addInput2").click(addInputField("#DeploymentEventsContainer", "Event nr. "));
            $("#addInput3").click(addInputField("#InjuredMembers", "Injured Member. "));
            $("#addInput4").click(addInputField("#InjuredSuspects", "Injured Suspect. "));
            $("#addInput5").click(addInputField("#InjuredCivilians", "Injured Civilian. "));

            function addInputField(containerId, placeholderText) {
                return function () {
                    const inputFieldsContainer = $(containerId);
                    const newEventNumber = inputFieldsContainer.children().length + 1; // Calculate the new event number
                    const newInputField = $("<div>").addClass("field").html('<input type="text" placeholder="' + placeholderText + newEventNumber + '">');
                    inputFieldsContainer.append(newInputField);
                };
            }
        });

        // Initialize Date and Time Picker
        document.addEventListener('DOMContentLoaded', function () {
            const datetimePicker = document.getElementById('datetimePicker');
            const todayButton = document.getElementById('todayButton');

            todayButton.addEventListener('click', function () {
                const currentDate = new Date();

                // Get UTC date and time components
                const year = currentDate.getUTCFullYear();
                const month = (currentDate.getUTCMonth() + 1).toString().padStart(2, '0');
                const day = currentDate.getUTCDate().toString().padStart(2, '0');
                const hours = currentDate.getUTCHours().toString().padStart(2, '0');
                const minutes = currentDate.getUTCMinutes().toString().padStart(2, '0');

                // Format the date and time in ISO format (YYYY-MM-DDTHH:MM)
                const formattedDate = `${year}-${month}-${day}T${hours}:${minutes}`;

                // Set the value of the datetimePicker input field to the current UTC date and time
                datetimePicker.value = formattedDate;
            });
        });

        function saveDataToLocalStorage() {
            // Get the values of input fields by their IDs
            const data = {
                DPLT: $('#DPLT').is(':checked'),
                K9PLT: $('#K9PLT').is(':checked'),
                HPLT: $('#HPLT').is(':checked'),
                ICname: $('#ICname').val(),
                CNname: $('#CNname').val(),
                TCname: $('#TCname').val(),
                MMMname: $('#MMMname').val(),
                deploymentType: $('.ui.selection.search.dropdown input[name="deploymentType"]').val(),
                datetimePicker: $('#datetimePicker').val(),
                loc: $('#loc').val(),
                startTime: $('#startTime').val(),
                endTime: $('#endTime').val(),
                event1: $('#event1').val(),
                member1: $('#member1').val(),
                suspect1: $('#suspect1').val(),
                civilain1: $('#civilain1').val(),
                signature: $('#signature').val()
            };

            // Store the data in local storage
            localStorage.setItem('metroDeploymentData', JSON.stringify(data));
        }

        // Function to load data from local storage
        function loadDataFromLocalStorage() {
            // Retrieve data from local storage
            const data = localStorage.getItem('metroDeploymentData');
            if (data) {
                const parsedData = JSON.parse(data);

                // Set the values of input fields from the retrieved data
                $('#DPLT').prop('checked', parsedData.DPLT);
                $('#K9PLT').prop('checked', parsedData.K9PLT);
                $('#HPLT').prop('checked', parsedData.HPLT);
                $('#ICname').val(parsedData.ICname);
                $('#CNname').val(parsedData.CNname);
                $('#TCname').val(parsedData.TCname);
                $('#MMMname').val(parsedData.MMMname);
                $('.ui.selection.search.dropdown input[name="deploymentType"]').val(parsedData.deploymentType);
                $('#datetimePicker').val(parsedData.datetimePicker);
                $('#loc').val(parsedData.loc);
                $('#startTime').val(parsedData.startTime);
                $('#endTime').val(parsedData.endTime);
                $('#event1').val(parsedData.event1);
                $('#member1').val(parsedData.member1);
                $('#suspect1').val(parsedData.suspect1);
                $('#civilain1').val(parsedData.civilain1);
                $('#signature').val(parsedData.signature);
            }
        }

        // Add event listeners to the input fields for automatic saving
        const inputFields = document.querySelectorAll('input, textarea, select');
        inputFields.forEach(function (inputField) {
            inputField.addEventListener('change', saveDataToLocalStorage);
        });

        // Load data from local storage when the page loads
        loadDataFromLocalStorage();

        // Function to clear all data from local storage with confirmation
        function clearLocalStorage() {
            const confirmation = confirm(
                "Are you sure you want to clear all local data?\n\n" +
                "This action will delete all stored data in your browser's local storage, including any unsaved work or settings. " +
                "If you're not sure, it's recommended to cancel this action."
            );

            if (confirmation) {
                // Backup the data
                const dataToBackup = localStorage.getItem('metroDeploymentData');
                localStorage.setItem('metroDeploymentDataBackup', dataToBackup);

                // Clear the original data
                localStorage.removeItem('metroDeploymentData');
                alert("Local storage has been cleared.");
            }
        }

        // Function to undo the clear action
        function undoClearLocalStorage() {
            const savedData = localStorage.getItem('metroDeploymentDataBackup');
            if (savedData) {
                localStorage.setItem('metroDeploymentData', savedData);
                alert("Clear action has been undone. Your data is restored.");
                // Reload the page to reflect the restored data
                location.reload();
            } else {
                alert("There is no data to restore.");
            }
        }

        // Add event listeners to the buttons
        const clearButton = document.getElementById('clearLocalStorageButton');
        if (clearButton) {
            clearButton.addEventListener('click', clearLocalStorage);
        }

        const undoButton = document.getElementById('undoLocalStorageButton');
        if (undoButton) {
            undoButton.addEventListener('click', undoClearLocalStorage);
        }
    </script>
</body>
</html>
